import{_ as s,o as a,c as n,V as l}from"./chunks/framework.d844f6b8.js";const F=JSON.parse('{"title":"聚合查询","description":"","frontmatter":{},"headers":[],"relativePath":"mongodb/aggregate.md","filePath":"mongodb/aggregate.md","lastUpdated":1688799651000}'),p={name:"mongodb/aggregate.md"},e=l(`<h1 id="聚合查询" tabindex="-1">聚合查询 <a class="header-anchor" href="#聚合查询" aria-label="Permalink to &quot;聚合查询&quot;">​</a></h1><h2 id="语法" tabindex="-1">语法： <a class="header-anchor" href="#语法" aria-label="Permalink to &quot;语法：&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.集合名称.aggregate([</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">管道:</span><span style="color:#A6ACCD;">{表达式}</span><span style="color:#FFCB6B;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">....</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="常用管道" tabindex="-1">常用管道： <a class="header-anchor" href="#常用管道" aria-label="Permalink to &quot;常用管道：&quot;">​</a></h2><ul><li>$group 将集合中的文档分组，用于统计结果</li><li>$match 过滤数据，只要输出符合条件的文档</li><li>$sort 聚合数据进一步排序</li><li>$skip 跳过指定文档数</li><li>$limit 限制集合数据返回文档数</li><li>....</li></ul><h2 id="常用表达式" tabindex="-1">常用表达式： <a class="header-anchor" href="#常用表达式" aria-label="Permalink to &quot;常用表达式：&quot;">​</a></h2><ul><li>$sum 总和 $sum:1 同 count 表示统计</li><li>$avg 平均</li><li>$min 最小值</li><li>$max 最大值</li></ul><p>准备：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.c3.insert(</span><span style="color:#A6ACCD;">{_id:1,name:</span><span style="color:#FFCB6B;">&quot;a&quot;</span><span style="color:#FFCB6B;">,sex:1,age:1}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">db.c3.insert(</span><span style="color:#A6ACCD;">{_id:2,name:</span><span style="color:#FFCB6B;">&quot;a&quot;</span><span style="color:#FFCB6B;">,sex:1,age:2}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">db.c3.insert(</span><span style="color:#A6ACCD;">{_id:3,name:</span><span style="color:#FFCB6B;">&quot;b&quot;</span><span style="color:#FFCB6B;">,sex:1,age:3}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">db.c3.insert(</span><span style="color:#A6ACCD;">{_id:4,name:</span><span style="color:#FFCB6B;">&quot;c&quot;</span><span style="color:#FFCB6B;">,sex:2,age:4}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">db.c3.insert(</span><span style="color:#A6ACCD;">{_id:5,name:</span><span style="color:#FFCB6B;">&quot;d&quot;</span><span style="color:#FFCB6B;">,sex:2,age:5}</span><span style="color:#A6ACCD;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>操作：</p><p>男女生的总年龄</p><p>#_id 必须加，后跟指定列</p><p>#rew 求和 返回结果数</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.c3.aggregate([</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		$group:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">_id:</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#A6ACCD;">$sex</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">res:</span><span style="color:#A6ACCD;">{$sum:</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#A6ACCD;">$sex</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#FFCB6B;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>求男女总人数</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.c3.aggregate([</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		$group:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">_id:</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#A6ACCD;">$sex</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">res:</span><span style="color:#A6ACCD;">{$sum:1}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>求学生总数和平均年龄</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.c3.aggregate([</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		$group:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">_id:null,</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">res:</span><span style="color:#A6ACCD;">{$sum:1}</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">total_avg:</span><span style="color:#A6ACCD;">{$avg:</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#A6ACCD;">$age</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#FFCB6B;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>查询男生女生人数，升序排序</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">db.c3.aggregate([</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">$group:{	</span><span style="color:#FFCB6B;">_id:</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#A6ACCD;">$sex</span><span style="color:#FFCB6B;">&quot;</span><span style="color:#FFCB6B;">,res:</span><span style="color:#A6ACCD;">{$sum:1}</span><span style="color:#FFCB6B;">}},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">$sort:{</span><span style="color:#FFCB6B;">res:1}}</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,20),o=[e];function r(t,c,i,C,b,u){return a(),n("div",null,o)}const d=s(p,[["render",r]]);export{F as __pageData,d as default};
